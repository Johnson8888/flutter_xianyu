{"data":{"children":[{"children":[{"src":"AlipaySDK.bundle/amc.i18n","tag":"meta","type":"i18n"},{"tag":"meta","type":"i18n","locale":{"zh_HK":{"agree_auth_fp":"同意協議並驗證指紋或"},"zh_TW":{"agree_auth_fp":"同意協議並驗證指紋或"},"en_US":{"agree_auth_fp":"Use fingerprint or"},"zh_CN":{"agree_auth_fp":"同意协议并验证指纹或"}}},{"rel":"stylesheet","tag":"link","href":"AlipaySDK.bundle/amc.css"},{"src":"AlipaySDK.bundle/amc.js","tag":"script"},{"src":"AlipaySDK.bundle/amc-meta.js","tag":"script"},{"src":"AlipaySDK.bundle/amc-api.js","tag":"script"},{"children":[{"tag":"text","text":"function AmcVI(d,e,f,c,b){this.VI_LOG_ACTION_TYPE=\"VI\";e||print(\"请实现onVIStatusChange回调\")||intentToCrash();f||print(\"请实现onHwFpStatusChange回调\")||intentToCrash();c||print(\"请实现sendVIRpcRequest回调\")||intentToCrash();b||print(\"请实现onVIRequestPwd回调\")||intentToCrash();this.viCallbacks={onVIStatusChange:e,onHwFpStatusChange:f,sendVIRpcRequest:c,onVIRequestPwd:b};this.viPlugin=d;this.isHwFp=false;this.standCallbackName=\"stand\"+this._randomStr(6);this.hwCallbackName=\"hw\"+this._randomStr(6);var a=this;window[this.standCallbackName]=function(g){a._viStandardCallback(g)};window[this.hwCallbackName]=function(g){a._viHwFpCallback(g)}}AmcVI.prototype={preStartVIPlugin:function(a,b){this._sendDataToVIPlugin(\"viPreStart\",a,b,this.hwCallbackName)},preLoadVIPlugin:function(a,b){this._sendDataToVIPlugin(\"viPreload\",a)},startVIPlugin:function(a,b){this._sendDataToVIPlugin(\"viStart\",a,b,this.standCallbackName)},closeVIPlugin:function(){this._sendDataToVIPlugin(\"viClosePage\")},sendPayStatus:function(a){this._sendDataToVIPlugin(\"payStatus\",{status:a?\"success\":\"fail\"})},_viHwFpCallback:function(a){this.isHwFp=true;this._viCommonCallback(a)},_viStandardCallback:function(a){this.isHwFp=false;this._viCommonCallback(a)},_viCommonCallback:function(b){var f={};try{f=JSON.parse(b)}catch(d){this._logError(\"VI\",\"解析核身JSON失败\"+d);return}var a=f.action;var c=f.data;if(a!=\"viStatus\"){this._logAction(a||\"actType\",this.VI_LOG_ACTION_TYPE)}if(\"viStatus\"==a){this._processVIStatus(c)}else{if(\"viRpcRequest\"==a){this._processVIRpcRequest(c)}else{if(\"viToPWD\"==a){this._processVIToPWD(c)}}}},_processVIStatus:function(d){if(!d){return}var a=d.status;var b=d.type;this._logAction((this.isHwFp?\"hw-\":\"\")+(b||\"type\")+\"-\"+(a||\"status\"),this.VI_LOG_ACTION_TYPE);var c=this.isHwFp?this.viCallbacks.onHwFpStatusChange:this.viCallbacks.onVIStatusChange;c&&c(d,a,b)},_processVIRpcRequest:function(a){if(!a){return}this.viCallbacks.sendVIRpcRequest(function(c){var b=c||{};b=JSON.parse(JSON.stringify(b));b.action=b.action||{};b.action.params=b.action.params||{};b.action.params.VIData=a;return b},this._processReceivedData.bind(this),this.isHwFp)},_processReceivedData:function(a){if(a&&a.VIData){this._sendDataToVIPlugin(\"viRpcResponse\",a.VIData)}},_processVIToPWD:function(a){this.viCallbacks.onVIRequestPwd(a)},_sendDataToVIPlugin:function(e,a,c,b){var d={action:e};if(a){d.data=a}if(b){d.callbacks={onViAction:b}}if(c){d.config=c}this._logAction((d&&d.action)||\"action\",this.VI_LOG_ACTION_TYPE);this.viPlugin.src=JSON.stringify(d)},_logError:function(a,b){amc&&amc.fn.logError(a,b)},_logAction:function(b,a){amc&&amc.fn.logAction(b,a)},_randomStr:function(e){var f=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";var d=f.length;var b=isNaN(e)?1:e;var a=\"\";for(var c=0;c<b;c++){a+=f[Math.floor(Math.random()*d)]}return a}};amc.fn.spmPageCreate(\"a283.b5790\");var rpc=amc.rpcData;var getTag=amc.fn.getById;var hide=amc.fn.hide;var show=amc.fn.show;var btnText=rpc.btnText||\"{{open_pcredit_and_pay}}\";var logAction=amc.fn.logAction;var logError=amc.fn.logError;var create=amc.fn.create;var huaWeiConfig={hwPaySuccessText:\"{{pay_success}}\",hwAuthingText:\"{{auth_fingering}}\",hwPayingText:\"{{paying}}\",hwRetryText:\"{{retry_finger}}\",hwAuthTip:\"{{agree_auth_fp}}\",hwInputPwdTip:\"{{input_pwd_s}}\"};var iOSConfig={fpAlertMsg:\"{{confirm_exit}}\",fpAlertCancelBtn:\"{{confirm_btn}}\",fpAlertToPwdBtn:\"{{input_pwd_s}}\",shouldDismissAfterAuth:\"Y\"};var rpcVIData=rpc.VIData;var verifyWithVI=!!rpcVIData;var haveDynamicAct=!!(rpc.dynamicAct);var VIDataForPwdPage=rpcVIData;var canGoBack=true;var confirmAction=buildConfirmActionWithAct(rpc.confirmAct);var protocolMap=getProtocolMap(rpc.protocolTip);var newProtocolList=rpc.protocols;var paySuccess=false;var PAYMENT_CODE_SUCCESS=\"0001\";var PAYMENT_CODE_FAIL=\"0002\";var VI_CHANNEL_MODE_FROM_TEMPLATE=\"1\";var amcVI=null;var isResume=false;var spmExposure=amc.fn.spmExposure;var spmClicked=amc.fn.spmClick;function getResource(a){if(a&&a.indexOf(\"local:\")===0){return amc.path+a.substr(6)}return a||\"\"}function init(){amcVI=new AmcVI(getTag(\"viPlugin\"),onVIStatusChange,onHwFpStatusChange,sendVIRpcRequest,onVIRequestPwd);try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit(false)}}}function initUI(){var b=amc.fn.iNav(amc.res.arrowLeft,rpc.pageTitle||\"\",null,null,onBack,null);getTag(\"body\").insertBefore(b,getTag(\"titleLine\"));spmExposure(\"a283.b5790.c12706.d23272\");var a=getResource(rpc.logo);if(a){getTag(\"logo\").src=a;show(\"logo\")}getTag(\"contentTitle\").innerText=rpc.contentTitle||\"\";getTag(\"content\").innerText=getContent();getTag(\"contentTail\").innerText=rpc.contentTail||\"\";getTag(\"protocols\").innerText=getProtocolTipText();spmExposure(\"a283.b5790.c12706.d23273\");getTag(\"btnText\").innerText=rpc.btnText||\"\";spmExposure(\"a283.b5790.c12706.d23271\");if(amc.isAndroid){getTag(\"protocols\").className=\"protocol-text-and\"}amcVI.preLoadVIPlugin(rpcVIData)}function getProtocolTipText(){if(newProtocolList){if(amc.fn.isArray(newProtocolList.items)&&newProtocolList.items.length>0){return newProtocolList.text||\"\"}else{return\"\"}}else{return rpc.protocolTip||\"\"}}function getContent(){var b=rpc.content||\"\";var a=b.split(\"\\n\").filter(function(c){return !!c}).length;if(a>1){getTag(\"content\").style.cssText=\"text-align: left\";if(amc.isAndroid){getTag(\"content\").style.cssText=\"font-size: 14px\";getTag(\"contentTail\").style.cssText=\"font-size: 14px\"}}return b}document.viewDidAppear=function(){if(isResume){amc.fn.spmExposureResume()}else{isResume=true}};function onConfirm(){spmClicked(\"a283.b5790.c12706.d23271\");if(haveDynamicAct){executeDynamicAct();return}if(paySuccess){return}if(verifyWithVI){amcVI.startVIPlugin(rpcVIData,iOSConfig);logAction(\"viLen|\"+(rpcVIData||\"\").length,\"VI\")}else{pwdFreePay()}}function executeDynamicAct(){var d=rpc.dynamicAct;var f=d.otherBtn||{};var b=d.url||\"\";var a=f.act||{};var l=f.txt||\"\";var i=d.title||\"\";var k=d.msg||\"\";var g=d.txt||\"\";var j=d.followAct||{};var c={action:a};var e;if(amc.isSDK){e={action:{name:\"loc:openurl\",params:{url:b,endflag:\"2\"}}}}else{e={action:{name:\"loc:openurl\",params:{url:b,endflag:\"4\",followAct:j}}}}var h={title:i,message:k,okButton:g,cancelButton:l};document.confirm(h,function(m){if(m.ok){document.submit(e);if(amc.isSDK){setTimeout(function(){showConfirmDlg(j)},1000)}}else{if(m.pageloading===\"0\"||m.pageloading===\"1\"){amc.fn.logCount(\"CMS\",\"dlg-callback-\"+m.pageloading)}else{document.submit(c)}}})}function onVIStatusChange(c,a,b){if(a===\"start\"){pwdType=b;canGoBack=(b!=\"wl\");if(pwdType==\"pwd\"||pwdType==\"spwd\"){onVIRequestPwd(rpcVIData)}else{toggleBioProcessLoading(true)}}else{if(a===\"end\"){toggleBioProcessLoading(false)}else{if(a===\"abort\"){amc.fn.exit()}else{if(a===\"awaitUser\"){toggleBioProcessLoading(false)}}}}}function onHwFpStatusChange(c,a,b){if(a===\"start\"){pwdType=b;hide(\"btnConfirm\");show(\"viPwdBox\");canGoBack=false}else{if(a===\"abort\"){amc.fn.exit()}}}function sendVIRpcRequest(b,a,c){if(!c){hide(\"gifImg\");startLoadignWithText(\"{{paying}}\")}submitPay(b,function(f){f=f||{};var e=f.status;try{var d=JSON.parse(f.VIData).finishCode;logAction(\"viCode|\"+d,\"VI\")}catch(g){}a&&a(f);if(c){if(e===PAYMENT_CODE_SUCCESS){amcVI.sendPayStatus(true)}}else{if(paySuccess){return}if(e===PAYMENT_CODE_SUCCESS){onPaySuccess()}else{if(e===PAYMENT_CODE_FAIL){onPayFailure()}}if(f.pageloading===\"1\"){startLoadignWithText()}else{if(f.pageloading===\"0\"){stopLoading()}}}})}function submitPay(a,c){var b={action:confirmAction};document.asyncSubmit(a(b),function(d){d=d||{};c&&c(d);if(d.confirmAct&&d.confirmAct.name){confirmAction=buildConfirmActionWithAct(d.confirmAct)}})}function onVIRequestPwd(a){if(a){VIDataForPwdPage=a}stopLoading();gotoPwdPage()}function pwdFreePay(){var a={action:confirmAction};a.action[\"neec\"]=\"6004\";startLoadignWithText();document.asyncSubmit(a,function(b){if(paySuccess){return}if(b.status==PAYMENT_CODE_SUCCESS){onPaySuccess()}else{if(b.status==\"0000\"){onPayFailure()}else{if(b.status==PAYMENT_CODE_FAIL){onPayFailure()}else{if(b.status==\"0006\"){onPayFailure()}}}}})}function onDestroy(){amcVI.closeVIPlugin()}function gotoPwdPage(){var a={};a={action:{name:\"loc:bnvb\"},param:{tplid:\"QUICKPAY@cashier-pwd-check-flex\",tpl:rpc.viPwdTpl,data:{payOrder:canGoBack,pwdTip:rpc.pwdTip,logon_id:rpc.logon_id,VIData:VIDataForPwdPage,confirmAct:confirmAction}}};document.submit(a)}function stripQuoteMark(a){return(a||\"\").replace(/^《?(.*?)》?$/g,\"$1\")}function showProtocols(a){spmClicked(\"a283.b5790.c12706.d23273\");if(newProtocolList){document.actionSheet({btns:newProtocolList.items.map(function(c){return stripQuoteMark(c.text)}),cancelBtn:\"取消\",},function(d){var c=newProtocolList.items[d.index];if(c){openweb(c.url,stripQuoteMark(c.text))}})}else{if(!a){return}var b=protocolMap[a];openweb(a,b)}}function openweb(a,b){if(b){document.submit({action:{name:\"loc:openweb('\"+a+\"', '\"+b+\"')\"}})}else{document.submit({action:{name:\"loc:openweb('\"+a+\"')\"}})}}function toggleBioProcessLoading(a){if(pwdType!=\"fp\"&&pwdType!=\"wl\"&&pwdType!=\"faceid\"&&pwdType!=\"FACEID\"&&pwdType!=\"ZFACE\"){return}if(a){startLoadignWithText(\"{{verifying}}\")}else{stopLoading()}}function onPayFailure(){paySuccess=false;stopLoading()}function onPaySuccess(){paySuccess=true;amc.fn.playGif(getTag(\"gifImg\"),amc.res.success);getTag(\"btnText\").innerText=\"{{pay_ok}}\"}function stopLoading(){amc.fn.playGif(getTag(\"gifImg\"),\"\");getTag(\"btnText\").innerText=btnText}function startLoadignWithText(a){amc.fn.playGif(getTag(\"gifImg\"),amc.res.loading);if(a){getTag(\"btnText\").innerText=a}}function onBack(){spmClicked(\"a283.b5790.c12706.d23272\");amc.fn.spmPageDestroy(\"a283.b5790\");if(rpc.backAct==\"back\"){document.submit({action:{name:\"loc:back\"}})}else{document.submit({action:{name:\"/cashier/view\"}})}}function buildConfirmActionWithAct(b){var a={name:\"/cashier/pay\"};if(b&&b.name){a=b}a.loadtxt=\"\";a.viChannelMode=VI_CHANNEL_MODE_FROM_TEMPLATE;return a}function onKeyDown(){if(event.which==4){onBack()}}function getProtocolMap(h){var a={};if(!h){return a}try{var d=new RegExp('<a[^><]*href=\"(http[^><\"]*)?\"[^><]*>([^><]*)?</a>',\"g\");var c=null;while((c=d.exec(h))!=null){if(c&&c[1]&&c[2]){var b=c[1];var g=c[2];if(g[0]==\"《\"&&g[g.length-1]==\"》\"){g=g.slice(1,g.length-1)}a[b]=g}}}catch(f){logError(\"commonSign\",\"协议解析错误 \"+f)}return a}function showConfirmDlg(b){var a={message:\"是否完成身份信息补全？\",okButton:\"已完成\",cancelButton:\"未完成\"};document.confirm(a,function(c){if(c.ok){var d={action:b};document.submit(d)}})};"}],"tag":"script"},{"children":[{"tag":"text","text":".btn-text {\n        color: #fff;\n    }\n\n    .logo-box {\n        margin-bottom: 16px;\n        width: 60px;\n    }\n\n    .title {\n        font-size: 18px;\n        color: #000000;\n        font-weight: bold;\n    }\n\n    .title-box {\n        margin-bottom: 12px;\n    }\n\n    .content-box {\n        margin-bottom: 15px;\n    }\n\n    .content-text {\n        color: #888888;\n        font-size: 16px;\n    }\n\n    .protocol-text {\n        color: #888888;\n        font-size: 16px;\n        line-height: 24px;\n    }\n\n    .protocol-text-and {\n        color: #888888;\n        font-size: 16px;\n        line-height: 24px;\n    }\n\n    .shade {\n        background-color: #fff;\n        opacity: 0.90;\n        margin-top: -16px;\n        height: 16px;\n    }\n\n    .header-box {\n        min-height: 30px;\n        flex: 1;\n    }\n\n    .footer-box {\n        min-height: 20px;\n        flex: 1;\n    }\n\n    .vi-finger-box {\n        justify-content: center;\n    }\n\n    .vi-finger {\n        height: 72px;\n        max-height: 72px;\n        min-height: 72px;\n    }\n\n    .bottom-box {\n        justify-content: flex-end;\n    }\n\n    .amc-i-nav-m-box {\n        align-items: center;\n        justify-content: center;\n        flex: 1.0;\n    }\n\n    .amc-i-nav-l-box {\n        padding-left: 15px;\n        height: 46px;\n        flex: 0;\n        justify-content: flex-start;\n        align-items: center;\n    }\n\n    .amc-i-nav-r-box {\n        height: 46px;\n        flex: 0;\n        justify-content: flex-end;\n        padding-right: 15px;\n        align-items: center;\n    }"}],"tag":"style"}],"tag":"head"},{"css":"amc-i-body","children":[{},{"css":"amc-1px-title-line","tag":"div","id":"titleLine"},{},{"css":"amc-v-box amc-scroll-flex amc-align-center amc-pd-lr","children":[{"css":"header-box","tag":"div","id":"headerBox"},{"css":"logo-box amc-hidden","tag":"img","id":"logo"},{"css":"title title-box","tag":"label","id":"contentTitle"},{"css":"content-box content-text amc-text-center","tag":"label","id":"content"},{"css":"content-text amc-text-center","tag":"label","id":"contentTail"},{"css":"footer-box","tag":"div","id":"footerBox"}],"tag":"div","id":"middleBox"},{},{"css":"shade","tag":"div"},{},{"css":"amc-v-box bottom-box","children":[{"css":"amc-pd-lr amc-v-box","children":[{"css":"amc-margin-b-s amc-margin-t protocol-text","onlink":"showProtocols","tag":"label","id":"protocols","highlightcolor":"#00000000"},{"css":"amc-btn-primary amc-justify-center amc-align-center amc-margin-tb","children":[{"css":"amc-btn-img amc-hidden","tag":"embed","id":"gifImg","type":"MQPPayGifView"},{"css":"btn-text amc-font-super-l amc-btn-ellpsis","tag":"label","id":"btnText"}],"onclick":"onConfirm()","tag":"div","id":"btnConfirm"}],"tag":"div"},{},{"css":"vi-finger vi-finger-box amc-hidden","children":[{"css":"vi-finger amc-flex-1","tag":"embed","id":"viPlugin","type":"VIPayPluginView"}],"tag":"div","id":"viPwdBox"}],"tag":"div"},{"css":"amc-iphone-x-pd-b","tag":"div"}],"tag":"body","id":"body","onkeydown":"onKeyDown()","onload":"init()"}],"tag":"html"},"publishVersion":"150924","name":"cashier-common-sign-flex","format":"JSON","tag":"QUICKPAY","time":"0038","tplId":"QUICKPAY@cashier-common-sign-flex","tplVersion":"5.3.9"}